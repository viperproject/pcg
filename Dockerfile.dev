# Development Dockerfile with standard Rust setup
FROM rust:1.89

# Install required dependencies for development
# Use -o Acquire::Check-Valid-Until=false to handle time sync issues in Docker
RUN apt-get -o Acquire::Check-Date=false -o Acquire::Check-Valid-Until=false update && apt-get install -y \
    pkg-config \
    tmux \
    vim \
    graphviz \
    nodejs \
    npm \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# Copy rust-toolchain to ensure correct Rust version
COPY rust-toolchain ./

# Install the correct Rust toolchain based on rust-toolchain file
# rustup will automatically read the rust-toolchain file and install the specified toolchain with components
RUN rustup show

# Set up Rust environment variables
ENV PATH="/usr/local/cargo/bin:${PATH}"
ENV RUSTUP_HOME="/usr/local/rustup"
ENV CARGO_HOME="/usr/local/cargo"
ENV RUST_BACKTRACE=1

# Create tmp directory with proper permissions
RUN mkdir -p tmp && chmod 777 tmp

# Default command for development
CMD ["/bin/bash"]

